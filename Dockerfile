FROM openjdk:16-slim

COPY ./objectstore/build/libs/*.jar /
COPY ./objectstore/build/resources/main/phiconfig.xml /

EXPOSE 8072

CMD java ${JAVA_OPTS} -Ddatabase.name=${EIS_DB_NAME} -Ddatabase.server.ip=${EIS_DB_IP} -Ddatabase.server.port=${EIS_DB_PORT} -Ddatabase.server.username=${EIS_DB_USER} -Ddatabase.server.password=${EIS_DB_PASSWORD} -Ddatabase.server.connection.timeout=${EIS_DB_CONNECTION_TIMEOUT_IN_SECONDS} -Ddatabase.server.socket.timeout=${EIS_DB_SOCKET_TIMEOUT_IN_SECONDS} -Ddatabase.server.active.connections=${EIS_DB_MAX_ACTIVE_CONNECTIONS} -Ddatabase.server.idle.connections=${EIS_DB_MAX_IDLE_CONNECTIONS} -Dstow.local.storagePath=${EIS_IMAGE_STORE_PATH} -Daudit.log.enabled=${AUDIT_LOG_ENABLED} -Deat.server.ip=${EAT_SERVER_IP} -Deat.server.port=${EAT_SERVER_PORT}  -Dprocess.id=${PROCESS_ID} -Drabbitmq.host=${EIS_RABBITMQ_HOST} -Drabbitmq.vhost=${EIS_RABBITMQ_VHOST} -Drabbitmq.port=${EIS_RABBITMQ_PORT} -Drabbitmq.username=${EIS_RABBITMQ_USERNAME} -Drabbitmq.password=${EIS_RABBITMQ_PASSWORD} -Drabbitmq.routingKey=${EIS_RABBITMQ_ROUTINGKEY} -Drabbitmq.exchange=${EIS_RABBITMQ_EXCHANGE} -Dspring.rabbitmq.connectionTimeoutInMilliseconds=${EIS_RABBITMQ_CONNECTION_TIMEOUT} -Drabbitmq.retry.max.delay=${EIS_RABBITMQ_RETRY_MAX_DELAY} -Drabbitmq.retry.delay=${EIS_RABBITMQ_RETRY_DELAY} -Drabbitmq.retry.max.attempts=${EIS_RABBITMQ_RETRY_MAX_ATTEMPTS} -Drabbitmq.retry.multiplier=${EIS_RABBITMQ_RETRY_MULTIPLIER} -Dretry.max.attempts=${RETRY_MAX_ATTEMPTS} -Dretry.delay=${RETRY_DELAY} -Dretry.multiplier=${RETRY_MULTIPLIER} -Dretry.max.delay=${RETRY_MAX_DELAY} -Dlog.level=${LOG_LEVEL} -DPHILOG_CONFIG_PATH=${PHILOG_CONFIG_PATH} -Dstore.threadpool.size=${STORE_THREADPOOL_SIZE} -Dsmall.image.threshold.kb=${SMALL_IMAGE_THRESHOLD_IN_KB} -Ddisk.space.safe.limit.inGB=${FILESTORE_SAFE_LIMIT_IN_GB} -Deat.retry.max.attempts=${EAT_RETRY_MAX_ATTEMPTS} -Deat.retry.delay=${EAT_RETRY_DELAY} -Deat.retry.multiplier=${EAT_RETRY_MULTIPLIER} -Deat.retry.max.delay=${EAT_RETRY_MAX_DELAY} -Deat.core.pool.size=${EAT_THREADPOOL_SIZE} -Deat.max.connections=${EAT_CONNECTION_POOL_SIZE} -Deat.inactivity.time.inms=${EAT_INACTIVITY_TIME_IN_MS} -Dgraceful.shutdown.timeout=${GRACEFUL_SHUTDOWN_TIMEOUT} -Dpublish.rabbitmq.message=${EIS_RABBITMQ_PUBLISH_MESSAGE} -Drabbitmq.channel.poolsize=${EIS_RABBITMQ_CHANNEL_POOL_SIZE} -Deat.data.accessed.url=${EAT_DATA_ACCESSED_URL} -DperformancelogLevel=${PERFORMANCE_LOG_LEVEL} -jar objectstore-1.0-SNAPSHOT.jar
